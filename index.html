<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ñ–∏–ª—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
      color: #000;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
    }
    .header {
      text-align: center;
      padding: 16px 0;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }
    .header h1 {
      font-size: 20px;
      font-weight: 600;
      color: #0057b8;
      margin: 0;
    }
    .complex-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 16px;
      cursor: pointer;
    }
    .complex-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
    }
    .card-content {
      padding: 14px;
    }
    .card-title {
      font-weight: 600;
      font-size: 16px;
      margin: 0 0 6px;
      color: #000;
    }
    .card-desc {
      font-size: 14px;
      color: #666;
      margin: 0 0 10px;
    }
    .btn {
      background: #0057b8;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: 500;
      width: 100%;
      cursor: pointer;
    }
    .back-btn {
      background: #f0f0f0;
      color: #0057b8;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 20px;
      font-weight: 500;
    }
    #detail-view { display: none; }
    #loading { text-align: center; padding: 40px; color: #888; }
  </style>
</head>
<body>
  <div class="container" id="catalog-view">
    <div class="header">
      <h1>–ñ–∏–ª—ã–µ –∫–æ–º–ø–ª–µ–∫—Å—ã</h1>
    </div>
    <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="complexes-list"></div>
  </div>

  <div class="container" id="detail-view">
    <div class="back-btn" onclick="showCatalog()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É</div>
    <div class="header">
      <h1 id="detail-title">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
    </div>
    <img id="detail-img" src="" style="width:100%; border-radius:12px; height:200px; object-fit:cover;">
    <p id="detail-info" style="margin:16px 0; color:#666;"></p>
    
    <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" style="width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:8px;">
    <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" style="width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:8px;">
    <button class="btn" onclick="submitLead()">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫–∞–∑</button>
  </div>

  <script>
    // === –ó–ê–ú–ï–ù–ò –≠–¢–û ===
    const FEED_URL = 'https://ai.allio.agency/feeds/vk_san_13.xml'; // ‚Üê —Å—é–¥–∞ –≤—Å—Ç–∞–≤—å URL —Ç–≤–æ–µ–≥–æ —Ñ–∏–¥–∞
    const TELEGRAM_CONFIG = {
      botToken: '8586234781:AAE87Am-arpkyk4tMcN44SYqSMJ8XDYrJKo',
      chatId: '896319728'
    };
    // ===================

    let complexes = [];
    let selectedComplex = null;

    async function loadComplexes() {
      try {
        const response = await fetch(FEED_URL);
        complexes = await response.json();
        renderCatalog();
      } catch (e) {
        document.getElementById('loading').innerText = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
        console.error(e);
      }
    }

    function renderCatalog() {
      const listEl = document.getElementById('complexes-list');
      const loadingEl = document.getElementById('loading');
      loadingEl.style.display = 'none';

      listEl.innerHTML = complexes.map(c => `
        <div class="complex-card" onclick="showDetail(${JSON.stringify(c)})">
          <img src="${c.image || ''}" alt="${c.title || ''}">
          <div class="card-content">
            <h3 class="card-title">${c.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h3>
            <p class="card-desc">${c.district || ''} ¬∑ ${c.status || ''}</p>
            <button class="btn">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          </div>
        </div>
      `).join('');
    }

    function showDetail(complex) {
      selectedComplex = complex;
      document.getElementById('detail-title').innerText = complex.title || '–ñ–ö';
      document.getElementById('detail-img').src = complex.image || '';
      document.getElementById('detail-info').innerText = `${complex.district || ''} ¬∑ ${complex.status || ''}`;

      document.getElementById('catalog-view').style.display = 'none';
      document.getElementById('detail-view').style.display = 'block';
    }

    function showCatalog() {
      document.getElementById('detail-view').style.display = 'none';
      document.getElementById('catalog-view').style.display = 'block';
    }

    function submitLead() {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      if (!name || !phone) {
        Telegram.WebApp.showAlert('–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
        return;
      }

      const message = 
        `üîî –ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–∫–∞–∑\n` +
        `–ñ–ö: ${selectedComplex.title || '‚Äî'}\n` +
        `–†–∞–π–æ–Ω: ${selectedComplex.district || '‚Äî'}\n` +
        `–ò–º—è: ${name}\n` +
        `–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}`;

      fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.botToken}/sendMessage`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({chat_id: TELEGRAM_CONFIG.chatId, text: message})
      }).then(() => {
        Telegram.WebApp.showAlert('–°–ø–∞—Å–∏–±–æ! –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏.');
        setTimeout(() => Telegram.WebApp.close(), 2000);
      });
    }

    loadComplexes();
  </script>
</body>
</html>
